<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Working Memory Capacity Trainer</title>
    <link rel="stylesheet" href="styles.css?v=7">
</head>
<body>
    <!-- Mobile Navigation Header -->
    <header id="mobile-header" class="mobile-header">
        <button class="nav-button back-button" onclick="window.app && window.app.goBack()" id="back-btn" style="display: none;">
            ‚Üê Back
        </button>
        <button class="nav-button home-button" onclick="window.app && window.app.returnToMenu()" id="home-btn">
            üè†
        </button>
        <span class="app-title">WMC Trainer</span>
        <button class="nav-button help-button" onclick="window.app && window.app.showHelp()" id="help-btn">
            ?
        </button>
    </header>

    <div id="app">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <div class="container">
                <h1>Working Memory Capacity Trainer</h1>
                <p class="subtitle">Based on validated cognitive research</p>

                <div class="info-box">
                    <h2>About This App</h2>
                    <p>This training application is based on peer-reviewed research on working memory capacity (WMC) measurement using Complex Span Tasks.</p>
                    <p>You will complete three different tasks that measure your ability to maintain information while processing distractions:</p>
                    <ul>
                        <li><strong>Operation Span:</strong> Solve math equations while remembering letters</li>
                        <li><strong>Symmetry Span:</strong> Judge symmetry while remembering locations</li>
                        <li><strong>Rotation Span:</strong> Judge letter rotations while remembering arrows</li>
                    </ul>
                </div>

                <div class="demographics">
                    <h3>Participant Information</h3>
                    <label>
                        Age:
                        <input type="number" id="age" min="17" max="35" value="25">
                    </label>
                    <label>
                        Gender:
                        <select id="gender">
                            <option value="">Prefer not to say</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </label>
                    <label>
                        Education:
                        <select id="education">
                            <option value="college">College Student</option>
                            <option value="non-college">Non-College</option>
                            <option value="graduate">Graduate Student</option>
                        </select>
                    </label>
                </div>

                <button class="btn-primary" onclick="window.app && window.app.selectTask()">Begin Training</button>
            </div>
        </div>

        <!-- Task Selection Screen -->
        <div id="task-selection" class="screen">
            <div class="container">
                <h1>Select a Task</h1>
                <div class="task-grid">
                    <div class="task-card" onclick="window.app && window.app.startTask('operation')">
                        <h3>Operation Span</h3>
                        <p>Verify math equations while remembering letters</p>
                        <div class="task-icon">+√ó</div>
                        <span class="difficulty">Difficulty: Medium</span>
                    </div>
                    <div class="task-card" onclick="window.app && window.app.startTask('symmetry')">
                        <h3>Symmetry Span</h3>
                        <p>Judge symmetry while remembering grid positions</p>
                        <div class="task-icon">‚¨õ</div>
                        <span class="difficulty">Difficulty: Medium-Hard</span>
                    </div>
                    <div class="task-card" onclick="window.app && window.app.startTask('rotation')">
                        <h3>Rotation Span</h3>
                        <p>Identify rotated letters while remembering arrows</p>
                        <div class="task-icon">‚Üª</div>
                        <span class="difficulty">Difficulty: Hard</span>
                    </div>
                </div>
                <button class="btn-secondary" onclick="window.app && window.app.viewResults()">View Results</button>
            </div>
        </div>

        <!-- Instructions Screen -->
        <div id="instructions" class="screen">
            <div class="container">
                <h2 id="task-title"></h2>
                <div id="instructions-content"></div>
                <button class="btn-primary" onclick="window.app && window.app.startPractice()">Start Practice</button>
                <button class="btn-secondary" onclick="window.app && window.app.selectTask()">Back</button>
            </div>
        </div>

        <!-- Practice Screen -->
        <div id="practice" class="screen">
            <div class="container">
                <h2>Practice: <span id="practice-phase"></span></h2>
                <div id="practice-content"></div>
            </div>
        </div>

        <!-- Main Task Screen -->
        <div id="task" class="screen">
            <div class="container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
                <div class="trial-info">
                    <span>Trial <span id="current-trial">1</span> of <span id="total-trials">15</span></span>
                    <span>Set Size: <span id="set-size">3</span></span>
                </div>
                <div id="task-content"></div>
            </div>
        </div>

        <!-- Recall Screen -->
        <div id="recall" class="screen">
            <div class="container">
                <h2>Recall Items in Order</h2>
                <div id="recall-content"></div>
                <div class="recall-buttons">
                    <button class="btn-warning" onclick="window.app && window.app.clearRecall()">Clear</button>
                    <button class="btn-primary" id="submit-recall-btn" onclick="console.log('Submit button clicked!'); window.app && window.app.submitRecall(); return false;">Submit</button>
                </div>
            </div>
        </div>

        <!-- Feedback Screen -->
        <div id="feedback" class="screen">
            <div class="container">
                <h2>Trial Complete</h2>
                <div id="feedback-content"></div>
                <button class="btn-primary" onclick="window.app && window.app.nextTrial()">Continue</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results" class="screen">
            <div class="container">
                <h1>Your Results</h1>
                <div id="results-content"></div>
                <div class="results-actions">
                    <button class="btn-primary" onclick="window.app && window.app.selectTask()">Try Another Task</button>
                    <button class="btn-secondary" onclick="window.app && window.app.exportResults()">Export Results</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Help & Information</h2>
                <button class="modal-close" onclick="window.app && window.app.closeHelp()">√ó</button>
            </div>
            <div class="modal-body">
                <h3>Quick Tips</h3>
                <ul>
                    <li><strong>Storage:</strong> Remember items in the order shown</li>
                    <li><strong>Processing:</strong> Must maintain 85% accuracy</li>
                    <li><strong>Time Limit:</strong> Based on your practice speed</li>
                    <li><strong>Trials:</strong> 15-21 trials per task</li>
                </ul>

                <h3>Navigation</h3>
                <ul>
                    <li>Use the <strong>‚Üê Back</strong> button to go to previous screen</li>
                    <li>Tap <strong>üè†</strong> to return to main menu</li>
                    <li>Tap <strong>?</strong> for help anytime</li>
                    <li>Your progress is automatically saved</li>
                </ul>

                <h3>Mobile Tips</h3>
                <ul>
                    <li>Use in portrait mode for best experience</li>
                    <li>Ensure stable internet connection for initial load</li>
                    <li>Works offline after first visit</li>
                    <li>Tap buttons firmly for accurate responses</li>
                </ul>

                <h3>Contact</h3>
                <p>For issues or questions, please refer to the documentation or contact support.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="window.app && window.app.closeHelp()">Got It</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=7"></script>
    <script>
        console.log('WMC Trainer v7 - MOBILE EXACTLY MATCHES DESKTOP - All grids and displays identical');

        // Register service worker for offline capability
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);

                        // Check for updates every 30 seconds
                        setInterval(() => {
                            registration.update();
                        }, 30000);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed:', err);
                    });
            });

            // Listen for cache update messages from service worker
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'CACHE_UPDATED') {
                    console.log('New version available! Reloading...', event.data.version);
                    // Auto-reload to get new version
                    setTimeout(() => {
                        window.location.reload(true);
                    }, 1000);
                }
            });
        }

        // Debug: Check if app is available
        setTimeout(() => {
            if (window.app) {
                console.log('‚úì App is available on window.app');
                console.log('‚úì submitRecall function exists:', typeof window.app.submitRecall);
            } else {
                console.error('‚úó App is NOT available on window.app!');
            }

            // Add backup event listener to submit button
            const submitBtn = document.getElementById('submit-recall-btn');
            if (submitBtn) {
                console.log('‚úì Submit button found, adding backup event listener');
                submitBtn.addEventListener('click', function(e) {
                    console.log('=== BACKUP EVENT LISTENER FIRED ===');
                    if (window.app && window.app.submitRecall) {
                        console.log('Calling submitRecall from backup listener...');
                        window.app.submitRecall();
                    } else {
                        console.error('window.app or submitRecall not available!');
                    }
                });
            } else {
                console.warn('Submit button not found in DOM');
            }
        }, 1000);
    </script>
</body>
</html>
